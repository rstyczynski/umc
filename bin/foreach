#!/bin/bash

function FOREACH {
    what=$1
    shift

    case $what in
        line)
            while read line; do 
                #echo $line
                how=$1
                case $how in
                    pipeto)
                        shift
                        echo $line | $@
                        ;;
                    *)
                        $@
                        ;;
                esac
            done
            ;;
        *)
            echo "Error: do not know how to process: $what"
            ;;
    esac
}

FOREACH $@
