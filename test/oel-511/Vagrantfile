# -*- mode: ruby -*-
# vi: set ft=ruby :

# This is the vagrant file for umc test machine based on Oracle Enterprise Linux 5.11
# in order to use this, you need to import the box as follows:
#
# 	vagrant box add --name oel511 http://cloud.terry.im/vagrant/oraclelinux-5-x86_64.box
#
Vagrant.configure("2") do |config|
  config.vm.box = "oel511"

  # this will map the umc root to the vagrant's home umc directory
  config.vm.synced_folder "../../", "/home/vagrant/umc"

  config.vm.provider "virtualbox" do |vb|
      vb.name = "umc_oel511_vm"
      vb.memory = "512"
  end

  config.vm.provision "shell", privileged: false, inline: <<-SHELL
    # set Europe/Prague timezone 
    sudo rm /etc/localtime && sudo ln -s /usr/share/zoneinfo/Europe/Prague /etc/localtime

    # install a library
    install_lib () {
    	echo "Installing $1 locally..."
        echo "Check $1-install.log"
        mkdir -p ~/umc/test/oel-511/logs
        ~/umc/test/oel-511/$1-install.sh &>~/umc/test/oel-511/logs/$1-install.log
        if [ $? != 0 ]; then
           echo >&2 "Error when installing $1, check ~/umc/test/oel-511/logs/$1-install.log for details"
        fi
    }

    # writes a line to bash_profile
    w2p () {
	echo $1 >>~/.bash_profile
    }

    # remove old logs directory 
    rm -fr ~/umc/test/oel-511/logs

    # install libraries
    install_lib python-2.7.11
    install_lib jdk-8u162
    install_lib sqlcl-17.4.0

    # other settings on user login
    echo "Writing misc settings to bash_profile" 
    w2p ""
    w2p "# various settings" 
    w2p "export LS_COLORS=''"
    w2p "alias ll='ls -all --color=always'"

    # initialize umc on user login
    echo "Writing umc settings to bash_profile"
    w2p ""
    w2p "# umc settings"
    w2p "source $HOME/umc/bin/umc.h &>/dev/null"
    w2p "umc"

  SHELL
  

end
