# -*- mode: ruby -*-
# vi: set ft=ruby :

# This is the vagrant file for umc test machine based on Oracle Enterprise Linux 5.11
# in order to use this, you need to import the box as follows:
#
# 	vagrant box add --name oel511 http://cloud.terry.im/vagrant/oraclelinux-5-x86_64.box
#
Vagrant.configure("2") do |config|
  config.vm.box = "oel511"

  # this will map the umc root to the vagrant's home umc directory
  config.vm.synced_folder "../../", "/home/vagrant/umc"

  config.vm.provider "virtualbox" do |vb|
      vb.name = "umc_oel511_vm"
      vb.memory = "512"
  end

  config.vm.provision "shell", privileged: false, inline: <<-SHELL
    # set Europe/Prague timezone 
    sudo rm /etc/localtime && sudo ln -s /usr/share/zoneinfo/Europe/Prague /etc/localtime

    # install python 2.7.11 locally
    echo "Installing python-2.7.11 locally, this will take few minutes..."
    echo "Check python-2.7.11-install.log"
    ~/umc/test/oel-511/python-2.7.11-install.sh &>~/umc/test/oel-511/python-2.7.11-install.log
    if [ $? != 0 ]; then
    	echo >&2 "Error when installing python 2.7.11 locally, check ~/umc/test/oel-511/python-2.7.11-install.log for details"
    fi

    # install jdk locally
    echo "Installing jdk-8u162 locally..."
    echo "Check jdk-8u162-install.log"
    ~/umc/test/oel-511/jdk-8u162-install.sh &>~/umc/test/oel-511/jdk-8u162-install.log
    if [ $? != 0 ]; then
      echo >&2 "Error when installing jdk-8u162 locally, check ~/umc/test/oel-511/jdk-8u162-install.log for details"
    fi

    # install sqlcl locally
    echo "Installing sqlcl-17.4.0 locally..."
    echo "Check sqlcl-17.4.0-install.log"
    ~/umc/test/oel-511/sqlcl-17.4.0-install.sh &>~/umc/test/oel-511/sqlcl-17.4.0-install.log
    if [ $? != 0 ]; then
      echo >&2 "Error when installing sqlcl 17.4.0 locally, check ~/umc/test/oel-511/sqlcl-17.4.0-install.log for details"
    fi

    # other settings on user login
    echo "Setting up other settings on user logon" 
    echo "" >>~/.bash_profile
    echo "# various settings" >>~/.bash_profile
    echo "export LS_COLORS=''" >>~/.bash_profile
    echo "alias ll='ls -all --color=always'" >>~/.bash_profile

    # initialize umc on user login
    echo "Setting up environment variables for umc"
    echo "" >>~/.bash_profile
    echo "# umc settings" >>~/.bash_profile
    echo "source $HOME/umc/bin/umc.h &>/dev/null" >>~/.bash_profile
    echo "umc" >>~/.bash_profile

  SHELL
  

end
